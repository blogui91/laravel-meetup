let glob = require("glob")
let fs = require('fs');

let baseJSPath = "resources/assets/js/";

let paths = {
	frontend: {
		basePath: baseJSPath + "components/**/*.vue",
		filename: baseJSPath + "components.manifest.js"
	},
	// admin: {
	// 	basePath: "resources/assets/admin/js/components/**/*.vue",
	// 	filename: "resources/assets/admin/js/components.manifest.js"
	// }
}


let VueAutoInstall = {

	getName(path) {
		let splited_path = path.split('/');
		let n = splited_path[splited_path.length - 1];
		let name = n.split('.')[0];
		return name;
	},
	createFile(namespace = 'frontend') {
		var self = this;
		let target = paths[namespace];

		// options is optional 
		glob(target.basePath, function(er, files) {
			let docs = [];

			let path;
			files.forEach(function(file) {
				let new_file = {};

				new_file.name = self.getName(file);
				new_file.path = "./" + file.split('js/')[1];

				docs.push(new_file);
			});

			let string_file = self.createContent(docs);
			fs.writeFile("./" + target.filename, string_file, function(err) {
				if (err) {
					console.log("there was an error saving files ", err);
				} else {
					console.log("Creating paths for each component...")
					console.log(target.filename + " has been generated")
				}
			});
		})
	},
	createContent(body) {
		return "//DO NOT UPDATE THIS FILE \n // This file is AUTOGENERATED \n\n export default" + JSON.stringify(body);
	}
}

VueAutoInstall.createFile();